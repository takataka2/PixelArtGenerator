<html>
    <head>
        <script type="text/javascript" language="javascript">
            var Matrix_Rows = 16;
            var Matrix_Cols = 16;
            var Color_Index = "#ffffff";
            
            window.onload = function(){
                var myTbl = document.getElementById("TBL");
 
                for(var i = 0; i < Matrix_Rows ; i++){
                    var row = myTbl.insertRow(-1);
                    
                    for(var j = 0; j < Matrix_Cols ; j++){
                        var col = row.insertCell(-1);
                    }
                }
                
                for (var i=0; i<myTbl.rows.length; i++) {
                    // tr内のtdをループ。cellsコレクションで行内セル位置取得。
                    for (var j=0; j<myTbl.rows[i].cells.length; j++) {
                        var Cells=myTbl.rows[i].cells[j]; //i番行のj番列のセル "td"
                        Cells.style.backgroundColor = "#FFFFFF";
                    }
                }              
            };
            
            function getColor() {
                var myTbl = document.getElementById('ColorTBL');
                // trをループ。rowsコレクションで,行位置取得。
                
                for (var i=0; i<myTbl.rows.length; i++) {
                    // tr内のtdをループ。cellsコレクションで行内セル位置取得。
                    for (var j=0; j<myTbl.rows[i].cells.length; j++) {
                        var Cells=myTbl.rows[i].cells[j]; //i番行のj番列のセル "td"
                        
                        // onclickで 'Mclk'を実行。thisはクリックしたセル"td"のオブジェクトを返す。
                        Cells.onclick =function(){getColorIndex(this);}
                    }
                }
            }
            
            function cellClear(){
                var button = document.getElementById("button");
                
                button.onclick = function(){
                
                    var myTbl = document.getElementById('TBL');
                    // trをループ。rowsコレクションで,行位置取得。
                
                    for (var i=0; i<myTbl.rows.length; i++) {
                        // tr内のtdをループ。cellsコレクションで行内セル位置取得。
                        for (var j=0; j<myTbl.rows[i].cells.length; j++) {
                            var Cells=myTbl.rows[i].cells[j]; //i番行のj番列のセル "td"
                            Cells.style.backgroundColor = "#FFFFFF";
                        }
                    }
                }
            }
            
            function picMake(){
                var button = document.getElementById("button2");
                var canvas = document.getElementById("canvas");
                var context = canvas.getContext("2d");


                button.onclick = function(){
                
                    var myTbl = document.getElementById('TBL');
                    // trをループ。rowsコレクションで,行位置取得。
                
                    for (var i=0; i<myTbl.rows.length; i++) {
                        // tr内のtdをループ。cellsコレクションで行内セル位置取得。
                        for (var j=0; j<myTbl.rows[i].cells.length; j++) {
                            var Cells=myTbl.rows[i].cells[j]; //i番行のj番列のセル "td"
                            
                            context.fillStyle = Cells.style.backgroundColor;
                            context.fillRect(j*10, i*10, 10, 10);
                        }
                    }
                }
            }
            
            function getCELL() {
                var myTbl = document.getElementById('TBL');
                // trをループ。rowsコレクションで,行位置取得。
                
                for (var i=0; i<myTbl.rows.length; i++) {
                    // tr内のtdをループ。cellsコレクションで行内セル位置取得。
                    for (var j=0; j<myTbl.rows[i].cells.length; j++) {
                        var Cells=myTbl.rows[i].cells[j]; //i番行のj番列のセル "td"
                        
                        // onclickで 'Mclk'を実行。thisはクリックしたセル"td"のオブジェクトを返す。
                        Cells.onclick =function(){cellChangeColor(this);}
                    }
                }
            }
            
            function cellChangeColor(Cell) { 
                Cell.style.backgroundColor = Color_Index;
            }
            
            function getColorIndex(Cell) { 
                Color_Index = Cell.style.backgroundColor;
            }
            
            function drawRect(x, y, width, height) {
                var context = canvas.getContext('2d');
                context.fillRect(x, y, width, height);
            }
            
            // try ～ catch 例外処理、エラー処理
            // イベントリスナーaddEventListener,attachEventメソッド
            try{
                window.addEventListener("load",getCELL,false);
                window.addEventListener("load",cellClear,false);
                window.addEventListener("load",getColor,false);
                window.addEventListener("load",picMake,false);
            }catch(e){
                window.attachEvent("onload",getCELL);
                window.attachEvent("onload",cellClear);
                window.attachEvent("onload",getColor);
                window.attachEvent("onload",picMake); 
            }
        
        </script>
        
        <style>
            table {
	           border-collapse: collapse;
            }
            td {
                width:30px;
                height:30px;
                border: solid 1px;
            }
            
        </style>
    </head>
    
    <body>
        <h2>ドット絵メーカー</h2>
        <div>
            <table id="TBL"></table>
        </div>
        <br>
        <div>
            <table id="ColorTBL">
                <tr>
                    <td style="background:#000000"></td>
                    <td style="background:#0000ff"></td>
                    <td style="background:#00ff00"></td>
                    <td style="background:#00ffff"></td>
                    <td style="background:#ff0000"></td>
                    <td style="background:#ff00ff"></td>
                    <td style="background:#ffff00"></td>
                    <td style="background:#ffffff"></td>                
                </tr>
            
            </table>
        </div>
        
        <input type="button" id="button" value="消去">
        <input type="button" id="button2" value="画像生成">
        <br>
        
        <canvas id="canvas" width="640" height="480"></canvas>
 
    </body>
</html>